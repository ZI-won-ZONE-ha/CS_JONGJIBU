# 경계 간 매핑하기

각 계층의 모델을 매핑하는 것에 대해 두 의견이 존재

- 찬성
    - 양 계층에서 같은 모델을 사용하면 둘이 강하게 결합된다.
- 반대
    - 계층 간 매핑을 하게 되면 보일러플레이트 코드가 증가한다.

매핑 전략의 장단점에 대해 깊게 알아보자

## 매핑하지 않기 전략

![image](https://github.com/ZI-won-ZONE-ha/CS_JONGJIBU/assets/88527476/4e728337-6dbc-425f-9485-d76e6748dc06)

웹 계층, Application 계층, 영속성 계층 모두 Account 클래스를 사용한다. → 같은 모델을 사용

각 계층마다 모델에 대한 특별한 요구사항이 존재한다면 도메인 모델 클래스에 이러한 요구사항이 모두 붙어 단일 책임 원칙이 위반되는 문제가 발생한다.

그래서 이러한 매핑하지 않기 전략은 복잡한 도메인 모델에서 사용하기 보다는 간단한 CRUD 유스케이스를 가지는 경우에 활용하는 것이 좋다.

→ **모든 계층이 정확하게 같은 구조와 정보를 필요로 하는 경우 매핑하지 않기 전략 활용!**

그리고 어떤 매핑 전략을 사용하더라도 나중에 언제든 바꿀 수 있으니 처음에는 매핑하지 않는 것도 하나의 방법

## 양방향 매핑 전략

![image](https://github.com/ZI-won-ZONE-ha/CS_JONGJIBU/assets/88527476/81acdc4e-8c9f-49ef-be53-2133b5a948d4)

각 계층이 전용 모델을 가진 매핑 전략을 뜻한다.

웹 계층은 웹 모델을 인커밍 포트에서 필요한 도메인 모델로 매핑, 인커밍 포트에 의해 반환된 도메인 객체를 다시 웹 모델로 매핑

영속성 계층은 아웃고잉 포트가 사용하는 도메인 모델과 영속성 모델 간의 매핑과 유사한 매핑 담당

**각 계층이 전용 모델을 가지고 있어 서로 영향을 주지 않는 장점이 있다.**

서로가 각자의 관심사에 맞춰 모델을 만들 수 있어 단일 책임 원칙을 지키게 된다.

다만 보일러 플레이트 코드가 생기는 단점이 존재

도메인 모델이 계층 경계를 넘어 통신하는 데 사용되고 있는 단점도 존재

## 완전 매핑 전략

![image](https://github.com/ZI-won-ZONE-ha/CS_JONGJIBU/assets/88527476/ff1810c4-cc3b-4d15-9c20-d761d883cf18)

각 연산마다 별도의 입출력 모델 사용하는 매핑 전략

**Command 또는 Request라고 불리는 작업에 특화된 모델을 사용하는 전략이다.**

웹 계층의 경우 입력을 Application 계층의 커맨드 객체로 매핑할 책임을 가진다.

유스케이스는 전용 커맨드를 가진다.

Application 계층은 커맨드 객체를 유스케이스에 따라 도메인 모델을 변경하기 위해 필요한 무언가로 매핑할 책임을 가진다.

**해당 전략은 여러 유스케이스의 요구사항을 함께 다뤄야 하는 매핑에 비해 구현하고 유지보수하기 쉽다.**

**해당 전략은 웹 계층과 Application 계층 사이에서 경계를 명확하게할 때 사용하기 좋다!**

→ 영속성 계층에 쓰기에는 오버헤드가 있음

## 단방향 매핑 전략

![image](https://github.com/ZI-won-ZONE-ha/CS_JONGJIBU/assets/88527476/b989d3d1-93e8-464a-a927-aa2822fab054)

모든 계층의 모델들이 같은 인터페이스를 구현하는 매핑 전략

인터페이스는 관련 있는 특성에 대한 getter 메서드를 제공하여 도메인 모델 상태를 캡슐화

도메인 객체를 바깥 계층으로 전달하고 싶을 때 매핑없이 전달 가능

외부 계층은 상태 인터페이스 활용 또는 전용 모델 매핑 결정 가능

→ **이 때 상태 인터페이스는 getter만 뚫어놓기 때문에 외부 계층에서 상태가 변경되지 않음을 보장**

**팩토리라는 DDD 개념과 잘 어울린다.**

**계층 간 모델이 비슷할 때 효과적인 방법**

## 매핑 전략 어떻게 사용할까?

그때그때 다르게 매핑 전략을 사용하자!

특정 전략을 전체 코드에 대해서 전역으로 설정하는 것은 좋은 방법이 아니다.

현재 상황에 맞게 매핑 전략을 사용하고 추후 전략이 마음에 들지 않으면 바꾸는 걸로 하면 된다.

팀에서 잘 합의해서 쓰도록 하자

가이드라인 예시

변경 유스케이스라면 웹 계층과 애플리케이션 계층 사이에 완전 매핑 전략쓰고 애플리케이션과 영속성 계층에는 매핑하지 않기 전략 쓰기

## 유지보수 가능한 소프트웨어를 만드는데 어떤 도움이 될까?

포트는 서로 다른 계층이 어떻게 통신해야 하는지를 정의

→ 각 유스케이스에 대해 좁은 포트를 사용하면 유스케이스마다 매핑 전략을 다양하게 가져갈 수 있다.

→ 특정 상황, 특정 시점에서 최선의 전략 선택 가능
