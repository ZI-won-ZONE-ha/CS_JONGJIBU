# 아키텍처 경계 강제하기

---

시간이 어느정도 흐르면 아키텍처의 경계가 무너질 수 있다.

→ 테스트, 유지보수가 어려운 코드가 된다.

경계를 강제하는 방법을 알아보자

## 경계와 의존성

---

![image](https://github.com/ZI-won-ZONE-ha/CS_JONGJIBU/assets/88527476/6ffd65e3-dd7f-4807-abc6-852daa5c53ee)

가장 내부에 도메인 엔티티

애플리케이션 계층은 서비스를 구현하기 위해 도메인 엔티티 접근

어댑터는 인커밍 포트를 통해 서비스 접근, 서비스는 아웃고잉 포트를 통해 어댑터 접근

설정 계층은 의존성 주입

이러한 경계를 강화하는 방법에 대해 알아보자

## 접근 제한자

---

경계를 강화하기 위해 자바에서 제공하는 접근 제한자를 활용할 수 있다.

default 접근 제한자가 중요하다.

→ 패키지를 통해 클래스들의 경계를 강화할 수 있기 때문에 중요함

모듈의 진입점을 담당하는 클래스만 public 접근 제한자로 제공하면 된다.

이렇게 접근 제한자를 통해 의존성을 관리하면 잘못된 의존성 규칙을 막을 수 있다.

해당 방법을 이용하려면 빈 등록을 스프링 클래스패스 스캐닝을 사용해야 한다.

다만 하위 패키지를 생성하기 어려운 단점이 존재한다.

## 컴파일 후 체크

---

런타임에 잘못된 의존성을 체크하는 방법이다.

Java에서는 ArchUnit을 통해 런타임 시점에 잘못된 의존성을 체크할 수 있다.

의존성 규칙을 위반할 경우 테스트를 실패시킨다.

![image](https://github.com/ZI-won-ZONE-ha/CS_JONGJIBU/assets/88527476/f8dda6b0-0ab0-4e75-a2bc-e5719c2f2d68)

책 124 - 125 예제 확인 후 직접 ArchUnit에 대해 공부해보자

## 빌드 아티팩트 (멀티 모듈 프로젝트)

---

빌드 아티팩트: 빌드 프로세스의 결과물

메이븐, 그레이들과 같은 빌드 도구를 활용하여 경계를 강화하는 방법이다.

빌드 도구의 주요한 기능 중 하나는 의존성 해결이다.

코드베이스를 빌드 아티팩트로 전환하기 위해 빌드 도구가 가장 먼저 하는 일은 코드베이스가 의존하는 모든 아티팩트가 사용가능한지 확인하는 것이다.

만약 사용 불가능 하다면 아티팩트 리포지토리로부터 이를 가져오고 가져오지 못한다면 빌드에 실패한다.

**결론: 분리된 별도 모듈을 활용하여 계층 간의 의존성을 강제한다!**

![image](https://github.com/ZI-won-ZONE-ha/CS_JONGJIBU/assets/88527476/4ab0fc0d-d7ea-4302-9210-3846fbb9a90a)

책 127 - 128 다시 읽어보고 멀티 모듈 좀 찾아보고 정리하기

장점으로는 빌드 도구가 순환 의존성을 허용하지 않아 빌드가 된 경우 순환 의존이 반드시 발생하지 않는다는 확신이 생긴다.

다른 모듈을 고려하지 않고 특정 모듈만 격리한 상태로 변경할 수 있는 장점도 있다.

→ 여러개의 모듈을 독립적으로 격리된 상태에서 변경할 수 있는 장점이 있다.

모듈 간 의존성이 빌드 스크립트에 분명하게 선언되어 있어 새로 의존성을 추가할 때 의식적으로 추가해야 되는 장점도 있다.

다만 유지보수 비용이 크다는 단점이 있어 아키텍처가 어느정도 안정된 상태가 되어야 한다.
