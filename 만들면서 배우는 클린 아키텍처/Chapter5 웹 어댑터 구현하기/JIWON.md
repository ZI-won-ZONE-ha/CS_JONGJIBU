# 웹 어댑터 구현하기

---

헥사고날 아키텍처는 외부 세계와의 모든 커뮤니케이션은 어댑터를 통해 이루어진다.

웹 인터페이스를 제공하는 어댑터의 구현 방법을 살펴보자

## 의존성 역전

---

웹 어댑터와 관련된 요소의 그림이다.

![image](https://github.com/ZI-won-ZONE-ha/CS_JONGJIBU/assets/88527476/be2c21f8-4f9b-4d58-b1c3-77e8d2cb38dd)

**웹 어댑터는 인커밍 어댑터이다. (주도하는 어댑터)**

외부로부터 요청을 받아 애플리케이션 코어를 호출하고 무슨 일을 할지 알려줌

제어의 흐름이 컨트롤러 → 애플리케이션 서비스 (인커밍)

**Application 계층은 Web Adapter가 통신할 수 있는 포트를 제공한다.**

**해당 아키텍처는 의존성 역전 원칙이 적용되었다.**

> 어댑터와 유스케이스 사이에 또 다른 간접 계층이 존재하는 이유
Application core가 **외부 세계(controller)와 통신할 수 있는 곳에 대한 명세가 port**이기 때문
port를 적절한 위치에 배치시키면 외부와 어떤 통신이 일어나는지 정확하게 알 수 있고, 유지보수할 때 도움이 된다!
11장 인커밍 포트 생략 방식도 있으니 참고
> 

웹 소캣을 통해 실시간 데이터를 사용자의 브라우저로 보내는 경우

> 웹 소캣:
웹소켓(WebSocket)은 웹에서 실시간 양방향 통신을 가능하게 하는 기술입니다. 기존의 HTTP 통신 방식과 달리, 웹소켓은 연결이 한 번 성립되면 서버와 클라이언트 간에 지속적인 데이터 교환을 할 수 있습니다. 이는 실시간 채팅, 게임, 금융 거래 데이터 업데이트 등 실시간으로 데이터를 주고받아야 하는 애플리케이션에 매우 유용합니다.
> 

![image](https://github.com/ZI-won-ZONE-ha/CS_JONGJIBU/assets/88527476/4e9fa8f5-d017-4315-af25-f644ccf95b2d)

웹 소캣을 사용하는 경우 반드시 포트가 필요하다.

**포트를 웹 어댑터에서 구현하고 Application Core에서 포트를 호출해야 한다.**

→ 이래야 양방향 통신이 가능해진다!

**이렇게 구현되는 경우 웹 어댑터는 인커밍 어댑터인 동시에 아웃고잉 어댑터가 된다.**

## 웹 어댑터의 책임

---

웹 어댑터는 아래와 같은 작업을 주로 한다.

- HTTP 요청을 자바 객체로 변환
    - URL, 경로, HTTP 메서드, 콘텐츠 타입과 같이 특정 기준을 만족하는 HTTP 요청을 수신해야 한다.
    - HTTP 요청을 자바 객체로 역직렬화
- 권한 검사
- 입력 유효성 검증
    - 웹 어댑터의 입력 모델에 맞는 입력 유효성 검증
    - → 웹 어댑터의 입력 모델을 유스케이스의 입력 모델로 변환할 수 있다는 것을 검증
- 입력을 유스케이스의 입력 모델로 매핑
- 유스케이스 호출
- 유스케이스의 리턴 값을 HTTP로 매핑
- HTTP 응답을 반환

이러한 책임들은 Application 계층에서 신경쓰면 안 된다.

해당 책임들이 Application 계층까지 가지 않도록 설계를 해야됨

→ Application 계층이 이를 알게되면 HTTP를 사용하지 않는 인커밍 어댑터에 대해서 동일한 도메인 로직 수행 불가능

**좋은 아키텍처는 선택의 여지를 남겨둔다!!!**

## 컨트롤러 나누기

---

웹 어댑터(컨트롤러)는 한 개 이상의 클래스로 구성해도 된다.

단, 같은 패키지에 두어 소속이 같다는 것을 알려줘야 한다.

엄청 큰 하나의 컨트롤러보다는 작은 여러 개의 컨트롤러가 나으니 가능한 작게 만들자

하나의 거대한 컨트롤러의 단점

- 나중에 읽기가 어려움 → 유지보수 어려워짐
- 테스트 코드 찾기가 어려움
- **모든 연산이 하나의 컨트롤러에 존재하여 데이터 구조를 재활용하게 됨**
    - 하나의 거대한 모델이 만들어진다.

**각 연산에 대해 별도의 웹 어댑터(컨트롤러)를 만들고 메서드와 클래스명을 유스케이스가 최대한 반영되게 설계**

이런 전용 모델 클래스들은 package private(default)으로 설정할 수 있어 다른 곳에서 재사용하지 못하게 막을 수 있다.

서로 다른 작업에 대해 충돌이 발생하지 않는 장점도 존재

## 유지보수 가능한 소프트웨어를 만드는 데 어떻게 도움이 될까?

---

웹 어댑터(컨트롤러)를 구현할 때는 HTTP → 객체, 객체 → HTTP와 같은 웹 관련 작업만 하고 도메인 로직은 절대 수행하면 안된다.

Application 계층은 반대로 HTTP에 대한 정보를 단 한 개라도 알아서는 안된다.

이렇게 설계를 하게 되면 **웹 어댑터를 다른 어댑터로 바꿀 수 있는 선택의 여지를 남김으로 유지보수가 가능한 소프트웨어가 된다.**

웹 컨트롤러를 나눌 때는 모델을 공유하지 않는 여러 작은 클래스로 만들자

이 과정을 통해 테스트가 쉽고 코드 파악이 쉽고 동시작업이 쉬운 코드를 만들 수 있게 된다.
