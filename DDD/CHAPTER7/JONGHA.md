# 7장 도메인 서비스

# 여러 애그리거트가 필요한 기능

- 문제점 : 도메인 영역의 코드 작성하다 보면, 한 애그리거트로 기능 구현이 어려워짐.
- 한 애그리거트에 넣기 애매한 도메인 기능을 억지로 특정 애그리 거트에 구현하면 안된다.
    - ex) 주문과 할인 기능. 주문에 종속도 안되고, 할인에 종속도 되지 안음.
    - 애그리 거트 책임 범위를 넘어서면, 외부에 대한 의존이 높아지고, 코드 복잡.
    - 애그리 거트의 범위를 넘어서는 도메인 개념이 애그리거트에 숨어들어 명시적으로 드러나지 않게 된다.
- 해결 방법: 도메인 기능을 별도 서비스로 구현

# 도메인 서비스

- **도메인 서비스 : 도메인 영역에 위치한 도메인 로직을 표현할 때 사용**
- 계산 로직 : 여러 애그리거트가 필요한 계산 로직이나, 한 애그리거트에 넣기에는 다소 복잡한 계산 로직.
- 외부 시스템 연동이 필요한 도메인 로직 : 구현하기 위해 타 시스템을 사용해야 하는 도메인 로직.

## 계산 로직과 도메인 서비스

- 할인 금액 규칙 계산 처럼 한 애그리거트에 넣기 애매한 도메인 개념 구현. → 도메인 서비스
- 도메인 서비스는 **상태없이** 로직만 구현한다.
- 도메인 서비스를 구현하는 데 필요한 상태는 다른 방법으로 전달 받는다.
- 할인 계산 서비스를 사용하는 주체는 **애그리거트 또는 응용서비스**가 될수 있다.
- 애그리거트 함수의 파라미터로 도메인 서비스를 전달하고, 이는 응용서비스가 전달한다.

<aside>
💡 주의 : 도메인 서비스 객체를 애그리거트에 주입하면 안된다. 그러면, 애그리 거트가 도메인 서비스에 의존하게 된다. 필드는 모델에서 중요한 구성 요소이다. 도메인 서비스는 저장대상도 아니고, 모든 곳에서 필요로 하지 않는다.

</aside>

- 반대로, 도메인 서비스의 기능을 실행할 떄, 애그리거트를 전달할 수 있다.
    - 도메인 서비스는 도메인 로직을 실행하지, 응용 로직을 실행하지 않는다.
    - 트랜젝션 처리는 응용 로직이므로, 도메인 서비스가 아닌 응용 서비스에서 해야 한다.

## 외부 서비스 연동과 도메인 서비스

- 인터페이스를 도메인 로직 관점에서 작성. 역할 관리 시스템과 연동한다는 관점으로 인터페이스를 작성하지 않았다..?

## 도메인 서비스의 패키지 위치

- 도메인 서비스는 도메인 로직을 표현하므로, 도메인 서비스의 위치는 다른 도메인 구성요소와 동일한 패키지에 있다.

## 도메인 서비스의 인터페이스와 클래스

- 도메인 서비스의 로직이 고정되어 있지 않다면, 도메인 서비스자체를 인터페이스로 구현하고 이를 구현한 클래스를 둘 수 있다.
- 도메인 서비스의 구현이 특정 기술에 종속되면 인터페이스와 구현 클래스로 분리한다.
- 도메인 영역이 특정 구현에 종속되는 것을 방지. 도메인 영역에 대한 테스트 쉬워진다.
