# Chapter 7. 도메인 서비스

---

## 여러 애그리거트가 필요한 기능

---

도메인 영역의 코드를 작성하다 보면, 한 애그리거트로 기능을 구현할 수 없을 때가 있다.

그렇다고 한 애그리거트에 이러한 기능을 억지로 넣는다면 애그리거트가 자신의 책임 범위를 넘어서는 기능을 구현하게 된다.

→ 코드가 길어지고 외부에 대한 의존이 높하지게 되며 코드 수정을 어렵게 만든다.

이러한 문제를 해결하기 위해 도메인 기능을 별도 서비스로 구현하는 방법이 있다.

## 도메인 서비스

---

도메인 서비스는 도메인 영역에 위치한 도메인 로직을 표현할 때 사용한다.

주로 다음과 같은 상황에서 도메인 서비스를 사용한다.

- 계산 로직과 같이 여러 애그리거트가 필요한 로직, 한 애그리거트에 넣기에는 다소 복잡한 로직
- 외부 시스템 연동이 필요한 도메인 로직, 구현하기 위해 타 시스템을 사용해야 하는 도메인 로직

### 계산 로직과 도메인 서비스

한 애그리거트에 넣기 애매한 도메인 개념을 구현하려면 애그리거트에 억지로 넣기보다는 **도메인 서비스를 이용해서 도메인 개념을 명시적으로 드러내면 된다.**

**도메인 서비스는 상태 없이 로직만 구현한다!**

→ 도메인 서비스를 구현하는데 필요한 상태는 다른 방법으로 전달 받는다.

도메인 서비스를 사용하는 주체는 애그리거트, 응용 서비스 둘 다 가능하다.

만약 **애그리거트가 도메인 서비스를 사용하는 주체라면 응용 서비스가 애그리거트 객체에 도메인 서비스를 전달해야 한다.**

도메인 서비스의 기능을 수행할 때 애그리거트를 전달해도 된다.

도메인 서비스는 도메인 로직을 수행하지 응용 로직을 수행하지 않는다.

→ **트랜잭션 처리는 응용 로직이므로 응용 서비스에서 처리해야 한다!**

> 만약 특정 기능이 응용 서비스인지 도메인 서비스인지 헷갈린다면 해당 로직이 애그리거트의 상태를 변경하거나 상태 값을 계산하는지 검사하면 된다.
> 

### 외부 시스템 연동과 도메인 서비스

외부 시스템이나 타 도메인과의 연동 기능도 도메인 서비스가 될 수 있다.

외부 시스템은 인터페이스를 만들고 infra 영역에 구현체를 두자

### 도메인 서비스의 패키지 위치

도메인 서비스는 도메인 로직을 표현하므로 도메인 구성요소와 같은 패키지에 존재한다!

만약 도메인 서비스가 많아지거나 엔티티 밸류와 같은 구성요소와 명시적으로 구분하고 싶다면 하위 패키지를 만들면 된다.

### 도메인 서비스의 인터페이스와 클래스

도메인 서비스의 로직이 고정되어 있지 않은 경우 도메인 서비스 자체를 인터페이스로 구현하고 이를 구현한 클래스를 사용할 수 있다.

→ 외부 시스템, 별도 엔진을 이용해서 구현해야할 때 분리하면 된다.

인터페이스 → 도메인 영역

구현체 → 인프라 영역

이렇게 인터페이스로 두어야 도메인 영역이 특정 구현에 종속되는걸 막고, 도메인 영역에 대한 테스트가 쉬워진다.
