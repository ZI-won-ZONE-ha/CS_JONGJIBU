# 도메인

소프트 웨어로 해결하고자 하는 문제 영역

- 도메인은 `하위 도메인`으로 구성된다.
- 하위 도메인을 어떻게 구성할 지는 상황에 따라 달라진다.
- 코딩에 앞서 요구사항을 올바르게 이해하는 것이 중요하다. 개발자도 도메인 지식을 갖춰야 한다.
    - Garbage in, Garbage out
        
        : 잘못된 값이 들어가면, 잘못된 결과가 나온다.
        

## 도메인 모델

특정 도메인을 개념적으로 표현한 것이다.

- 모델링의 표현 방식이 달라질 수 있다.
- 모델의 각 구성 요소는 특정 도메인으로 한정할 때 의미가 완전해지므로 여러 하위 도메인을 각각 모델링해야한다.

# 도메인 모델 패턴

## 아키텍쳐 구성

- Presentation : 사용자 요청 처리하고, 정보를 보여준다.
- Application : 요청한 기능을 실행한다. 업무로직을 직접 구현하지 않으며, 도메인 계층을 조합하여 기능 실행.
- 도메인 : 시스템이 제공할 도메인 규칙을 구현
- 인프라 스트럭쳐 : 데이터 베이스, 메시징 시스템과 같은 외부 시스템 연동

핵심 규칙을 구현한 코드는 도메인 모델에만 위치하여, 규칙이 바뀌거나 규칙을 확장해야 할때 다른 코드에 변경을 덜 준다. 

> 도메인 모델 : 도메인 계층을 구현할 때 사용하는 객체 모델
> 

# 엔티티와 밸류

## 엔티티

- 식별자를 가진다.
- 엔티티 객체마다 고유하여, 각 엔티티는 서로 다른 식별자를 갖는다.
- 엔티티의 식별자는 바뀌지 않는다.
- 엔티티 객체의 식별자가 같으면 두 엔티티는 같다.

### 엔티티의 식별자 생성

- 특정 규칙에 따라 생성
- UUID, NanoID 같은 고유 식별자 생성기 사용
- 값을 직접 입력
- 일련 번호 사용 (시퀀스, DB 자동 증가 칼럼 사용)

## 밸류

- 개념적으로 완전한 하나를 표현할 때 사용
- 의미를 명확하게 표현하기 위해 사용
- 밸류 타입을 위한 기능 추가 가능
- 불변 객체 : 데이터 변경 기능을 제공하지 않는 타입
    - 장점 : 안전한 코드를 작성 가능하다.
    - 만약 불변이 아니라면, setValue로 인한 참조 투명성 문제 때문에 다음과 같이 코드를 작성해야 한다.
    
    ```java
    public OrderLine(Money price) {
    		this.price = new Money(price.getValue);
    }
    ```
    
    - 하지만 불변이라면, 데이터를 바꿀 수 없기 때문에, 파라미터로 전달받은 price를 안전하게 사용 가능.
    - **불변 객체란 객체가 참조하고 있는 값이 외부에 의해 변형되지 않는 객체를 의미한다.**
    - thread-safe하다.  참조 투명성
    
    [불변객체를 만드는 방법](https://tecoble.techcourse.co.kr/post/2020-05-18-immutable-object/)
    
- 불변 타입의 장점을 살릴 수 있도록, 밸류 타입은 불변으로 구현한다.

### 엔티티 식별자와 밸류 타입

주문 번호를 OrderNo와 같이 타입을 만들 수 있다. 

### 도메인에 setter 지양

- 도메인의 핵심 개념이나 의도를 사라지게 한다.
- 도메인 객체를 생성할 때 온전하지 않는 상태가 될 수 있다. → 도메인 객체가 불완전한 상태로 사용되는 것을 막으려면, 생성 시점에 필요한 것을 전달해 준다. → 즉 생성자를 통해 필요한 데이터를 모두 받는다.

cf) DTO get/set 메서드

- 도메인 로직을 담고있지 않아 get/set 메서드 제공해도 도메인 객체의 데이터 일관성 영향 줄 가능성 높지 않다.
- private 필드에 직접 값 할당할 수 있는 기능 제공하여, 불변 객체의 장점을 dto 까지 확장할 수 있다.

# 유비쿼터스 언어

- 최대한 도메인 용어를 사용해서 도메인 규칙을 코드로 작성하게 되므로 버그를 줄인다.
- 전문가 관계자, 개발자가 도메인과 관련된 공통의 언어를 만들고, 이를 대화, 문서, 도메인 모델, 코드, 테스트 등 모든 곳에서 같은 용어를 사용한다.
- 소통 과정에서 용어의 모호함을 줄이고, 개발자는 도메인과 코드 사이에서 불필요한 해석 과정을 줄인다.
